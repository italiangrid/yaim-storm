##############################################################################
# Copyright (c) Members of the EGEE Collaboration. 2004.
# See http://www.eu-egee.org/partners/ for details on the copyright
# holders.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS
# OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
##############################################################################
#
# NAME :        config_storm_gridhttps_generic
#
# DESCRIPTION : This function configures users and certificates on a StoRM Gridhttps.
#
# AUTHORS :     grid-release@infn.it
#
# NOTES :
#
# YAIM MODULE:  yaim-storm
#
##############################################################################

function config_storm_gridhttps_generic_check () {

  requires $1 STORM_GRIDHTTPS_USER STORM_USER
  return $?
}

function config_storm_gridhttps_generic_setenv () {

  yaimlog INFO "No enviroment variables to set."

}

function config_storm_gridhttps_generic () {

  FUNCTION="config_storm_gridhttps_generic"

  # Check STORM_GRIDHTTPS_USER is STORM_USER
  if [ "${STORM_GRIDHTTPS_USER}" = "${STORM_USER}" ]; then
    yaimlog INFO "${FUNCTION}: \$STORM_GRIDHTTPS_USER must be equal to \$STORM_USER - OK"
  else
    yaimlog ERROR "${FUNCTION}: \$STORM_GRIDHTTPS_USER must be equal to \$STORM_USER"
    yestr ${YEX_CONFIG}
    yaimlog ERROR "${YERRORSTR}"
    return ${YEX_CONFIG}
  fi

  #Adding JAVA_HOME variable to service environment
  if [ ! -z ${JAVA_HOME} ] ; then
    yaimlog DEBUG "${FUNCTION}: JAVA_HOME variable available"
  elif [ ! -z ${JAVA_LOCATION} ] ; then
    yaimlog DEBUG "${FUNCTION}: found java in JAVA_LOCATION"
  	JAVA_HOME=${JAVA_LOCATION}
  elif [ -L /usr/java/latest ] ; then
    yaimlog DEBUG "${FUNCTION}: found java in filesystem"
  	JAVA_HOME="/usr/java/latest"
  fi
  if [ ! -z ${JAVA_HOME} ] ; then
  	yaimlog DEBUG "${FUNCTION}: Setting up JAVA environment"
  	yaimgridenv_set JAVA_HOME ${JAVA_HOME}
  fi

  # Register service to start at boottime
  /sbin/chkconfig --add storm-gridhttps-server
  /sbin/chkconfig storm-gridhttps-server on
  
  # Exit with success
  return ${YEX_OK}    

}
